<!DOCTYPE html>
<html ng-app="myModule">
<head>
<title>Paradiddles System</title>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/angular.min.js"></script>
<script src="/js/underscore-min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<link rel="stylesheet" href="/js/jquery-ui-1.10.3.custom.css">
<link rel="shortcut icon" href="/images/mid.ico">
<script src="/js/pragmatic-angular.js"></script>
<script src="/js/drumset.js"></script>
<style type="text/css">
body {color: #001326; background: #F4F4F4; font-family: monospace;}
.PS {height: auto; width: 11%; float: right; cursor: pointer;}
#right {margin-right:3%;}
#play {cursor: url(images/Drumsticks.cur),auto;}
.first {color: red;}
.btn-large {padding: 8px 15px; font-size: 17.5px; -webkit-border-radius: 6px; -moz-border-radius: 6px; border-radius: 6px; cursor: pointer;}
.btn-large:hover { background-color: #BACCDF;}
pre {border: 1px solid #999; background-color: #FFE; font-weight: bold; word-wrap: break-word; text-align: center; padding-top:1px;}
.l {background-color: rgb(254, 254, 210)}
.r {background-color: rgb(242, 230, 255)}
#selectmidi, input[type="number"] {border-radius: 18px; border:1px dotted #0071b5; font-weight: bolder; height: 28px; background-color:#FFE; cursor: pointer; text-align: center;}
input[type="number"] {height: 23px;}
input[type=text] { border: none; font-family: monospace; font-size: inherit; font-weight: bold; background: #FFE;}
span {line-height: 270%;}
.Center {
  width: 86%; height: 28%; margin: auto; margin-top: 25px; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background-color: inherit;
}
li { border:2px solid white; width: 8%; display: table; letter-spacing:10px; font-size: 1.1em; text-align: center;}
li:hover { border:2px dotted grey;}
i:hover { border:1px dotted grey;}
i { border:1px solid white; width: 8%; display: table; color: rgb(111, 59, 139);font-size: 0.9em;text-align:center;white-space:nowrap;
 -webkit-transition: 0.2s linear; -moz-transition: 0.2s linear; transition: 0.2s linear; cursor: pointer;}
i.L {border:1px solid red;}
i.R {border:1px solid green;}
.selected {
  color: black; border:2px dotted rgb(128, 146, 132);
}
#drumsetL, #drumsetR {height: 450px; width: 46%; margin-top: 18px; border:2px solid white; border-radius: 18px; float: right; margin-right: 15px; background-image: url("./images/midi.png");}
.set {
 font:bold italic 27px/45px Georgia;
 width:120px;
 height:120px;
 border:#000 1px solid;
 border-radius:100px;
 background:#fee;
 color: rgba(196, 255, 121, 0.55);
 text-shadow: 2px 2px #000913;
 transform:scaleY(0.4);
 -moz-transform:scaleY(0.4);
 -webkit-transform:scaleY(0.4);
 cursor: move;
 box-shadow: -5px 7px 15px rgba(103, 59, 59, 0.76);
}
.drum {height:54px;}
.set.down, .set.Down {background: grey;}
.set.up, .set.Up {background:#fee;}
</style>
</head>

<body ng-controller="myController" ng-init="onReady()">

<div id="right" class="PS">
<ul>
 <li ng-repeat="i in R5" ng-mousedown="changeRpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Rpattern }"><strong>{{i.p}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in R6" ng-mousedown="changeRpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Rpattern }"><strong>{{i.p}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in R7" ng-mousedown="changeRpattern(i);" ng-class="{ 'selected': i == Rpattern }"><strong>{{i}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in R8" ng-mousedown="changeRpattern(i);" ng-class="{ 'selected': i == Rpattern }"><strong>{{i}}</strong></li>         
</ul>
</div>
<div class="PS">
<ul>
 <li ng-repeat="i in R1" ng-mousedown="changeRpattern(i.p);" ng-class="{ 'selected': i.p == Rpattern }" style="background:{{i.bg}}"><strong>{{i.p}}</strong></li>
</ul>
<ul>
 <li ng-repeat="i in R2" ng-mousedown="changeRpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Rpattern }"><strong>{{i.p}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in R3" ng-mousedown="changeRpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Rpattern }"><strong>{{i.p}}</strong></li>      
</ul>
<ul>
 <li ng-repeat="i in R4" ng-mousedown="changeRpattern(i);" ng-class="{ 'selected': i == Rpattern }"><strong>{{i}}</strong></li>         
</ul>
</div>
<div class="PS">
<ul>
 <li ng-repeat="i in L1" ng-mousedown="changeLpattern(i.p);" ng-class="{ 'selected': i.p == Lpattern }" style="background:{{i.bg}}"><strong>{{i.p}}</strong></li>
</ul>
<ul>
 <li ng-repeat="i in L2" ng-mousedown="changeLpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Lpattern }"><strong>{{i.p}}</strong></li>       
</ul>
<ul>
 <li ng-repeat="i in L3" ng-mousedown="changeLpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Lpattern }"><strong>{{i.p}}</strong></li>
</ul>
<ul>
 <li ng-repeat="i in L4" ng-mousedown="changeLpattern(i);" ng-class="{ 'selected': i == Lpattern }"><strong>{{i}}</strong></li>         
</ul>
</div>
<div class="PS">
<ul>
 <li ng-repeat="i in L5" ng-mousedown="changeLpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Lpattern }"><strong>{{i.p}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in L6" ng-mousedown="changeLpattern(i.p);" style="background:{{i.bg}}" ng-class="{ 'selected': i.p == Lpattern }"><strong>{{i.p}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in L7" ng-mousedown="changeLpattern(i);" ng-class="{ 'selected': i == Lpattern }"><strong>{{i}}</strong></li>         
</ul>
<ul>
 <li ng-repeat="i in L8" ng-mousedown="changeLpattern(i);" ng-class="{ 'selected': i == Lpattern }"><strong>{{i}}</strong></li>         
</ul>
</div>

<div style="float:right;">
<p>
<label>MIDI Out:</label><select id=selectmidi ng-change="changemidi();" ng-model="_out">
 <option ng-init="_out=list[0]" ng-repeat="i in list" ng-selected="{{i==_out}}" value="{{i}}">{{i}}</option>
</select>
<label> Metronome </label> <input type="checkbox" ng-model="checked">
<button class="btn-large" id=play ng-click='play();' ng-jquery-plugin="{button : { label: playing }}"></button>
</p>
</center>

<div>
 <label>Tempo: </label><input type="number" min="0" max="400" ng-change='changetempo();' ng-click="blur();" ng-model="_tempo"/>
 <label>Pitch: </label><input type="number" min="0" max="127" ng-change='changePitch();' ng-click="blur();" ng-model="_pitch"/> 
 <button ng-click='shuffle();' ng-jquery-plugin="{button : { label: 'R.N.'}}" ng-init="shuffle()"></button>
 <button ng-click='random();' ng-disabled="state" ng-jquery-plugin="{button : { label: 'Randomize',disabled:false}}"></button>
</div>
<pre>   beats: <input type="text" ng-click="blur();" ng-model="beats">count: <input type="text" size="4" ng-model="count" ng-click="blur();" value="1" ng-class="{ 'first': count == 0 }"></pre>
<div>
 <div title="beats" ng-jquery-plugin="{ slider : { min: 1, max: 16, value: 8, stop : onStop }, width: W }"></div>
</div> 
<div ng-click="side = 'R';" id="drumsetR">
<div ng-model="Set" class="drum" ng-repeat="i in Set track by $index">
 <div class='set' title='drag it' ng-class="{'down': ((Set.length==1&&$index==!Snd)||(Set.length>1&&$index==Snd)), 'up': ((Set.length==1&&$index==Snd)||(Set.length>1&&$index==!Snd)) }" ng-jquery-plugin="{draggable : { containment: '#drumsetR' }}" ng-dblclick="destroy('R',$index);">{{Set.length==1?Sound:mas[i]}}</div>
</div>
</div>
<div ng-click="side = 'L';" id="drumsetL">
<div ng-model="set" class="drum" ng-repeat="i in set track by $index">
 <div class='set' title='drag it' ng-class="{'down': ((set.length==1&&$index==!snd)||(set.length>1&&$index==snd)), 'up': ((set.length==1&&$index==snd)||(set.length>1&&$index==!snd)) }" ng-jquery-plugin="{draggable : { containment: '#drumsetL' }}" ng-dblclick="destroy('L',$index);">{{set.length==1?sound:mas[i]}}</div>
</div>
</div>
</div>
<div style="float:left;" ng-class="{'l': (side=='L'), 'r': (side=='R')}">
 <i ng-repeat="ms in mas" ng-mousedown="OnChange(side,$index);" ng-dblclick="addToSet(side,$index);" ng-class="{'L': ms==sound , 'R': ms==Sound }" ng-if="$index<31"> <!--ng-hide="$index>30" --> 
    <i>{{ ms }}</i>
 </i>
</div>
<div style="float:left;" ng-class="{'l': (side=='L'), 'r': (side=='R')}">
 <i ng-repeat="ms in mas" ng-mousedown="OnChange(side,$index);" ng-dblclick="addToSet(side,$index);" ng-class="{'L': ms==sound , 'R': ms==Sound }" ng-if="$index>30"> <!--ng-hide="$index<31" -->  
    <i>{{ ms }}</i>
 </i>
</div>
<!--<script>

var myModule = angular.module('myModule',['pragmatic-angular']);
function myController($scope, $timeout) {
 
  $scope.shuffle = function() {
    $scope.note = _.sample(_.range(27, 88));
    $scope.sound = $scope.mas[$scope.note]; console.log($scope.sound);
    $scope.Note = _.sample(_.range(27, 88));
    $scope.Sound = $scope.mas[$scope.Note]; console.log($scope.Sound);
    $scope.set[0] = $scope.note; console.log($scope.set + ';' + _.size($scope.set));
    $scope.Set[0] = $scope.Note; console.log($scope.Set + ';' + _.size($scope.Set));
  };
 
  $scope.OnChange = function(set, index) {
    if (set === "L") {
      var note = index + 26;
      $scope.note = note;
      $scope.sound = $scope.mas[note]; console.log($scope.sound);
    }
    if (set === "R") {
      var note = index + 26;
      $scope.Note = note;
      $scope.Sound = $scope.mas[note]; console.log($scope.Sound); 
    }
  }
   
  $scope.onStop = function(event, ui) {
      $scope.beats = ui.value;
      $scope.$apply();
  };

  $scope.destroy = function(set, index) {
    if (set === "L") {
      if(_.size($scope.set) > 1){
	     $scope.set.splice(index, 1);
	     if(_.size($scope.set) == 1){
	       $scope.sound = $scope.mas[$scope.set[0]];
	       $scope.note = $scope.set[0];
	     };  
	     console.log($scope.set + ';' + _.size($scope.set));
	   };
	 }
	 if (set === "R") {
	   if(_.size($scope.Set) > 1){
	     $scope.Set.splice(index, 1);
	     if(_.size($scope.Set) == 1){
	       $scope.Sound = $scope.mas[$scope.Set[0]];
	       $scope.Note = $scope.Set[0];
	     }; 
	     console.log($scope.Set + ';' + _.size($scope.Set));
	   };
	 };
  };
  
  $scope.addToSet = function(set, index) {
    if (set === 'L') { 
      var note = index + 26;
      if (_.indexOf($scope.set, note) == -1 && _.size($scope.set) <= 7){
        $scope.set.push(note);
        console.log($scope.set + ';' + _.size($scope.set));      
      };
    }
    if (set === 'R') { 
    var note = index + 26;
    if (_.indexOf($scope.Set, note) == -1 && _.size($scope.Set) <= 7){
      $scope.Set.push(note);
      console.log($scope.Set + ';' + _.size($scope.Set));      
      };
    };
  };
  
  $scope.play = function() {
    if(!(Jazz && Jazz.isJazz)) return;
    $scope.state = !$scope.state;
    if($scope.state){
      $scope.playing = 'Play'; $( "#play" ).button( "option", "label", "Play" );
      $timeout.cancel(timeout); 
      $scope.Playing = false; $timeout.cancel($scope.Timeout); 
    } 
    else {
      $scope.playing = 'Stop'; $( "#play" ).button( "option", "label", "Stop" );
      $scope.count=-1; tick();
    }  
  };
  
  $scope.random = function() { //console.log($scope.Playing)
    $scope.Playing = !$scope.Playing;
    if($scope.Playing){
      $scope.randomize();
    } 
    else {
      $timeout.cancel($scope.Timeout); 
    }  
  };
  
  $scope.randomize = function() {
    var minus = [7,0,1,2,3,4,5,6]; var last = minus[$scope.count]; var blast = minus[last];
 	 if(_.size($scope.Set) == 1){	
      $scope.Snd = $scope.Updown();
    }
    else{
      if(Number($scope.Rpattern[blast]) == 0 && Number($scope.Rpattern[last]) == 1){
        $scope.Visual();
      }
    };
    if(_.size($scope.set) == 1){	
    	$scope.snd = $scope.updown();
    }
    else{
     	if(Number($scope.Lpattern[blast]) == 0 && Number($scope.Lpattern[last]) == 1){
     	  $scope.visual();
      }
    };     
    $scope.Timeout = $timeout(function() {
      $scope.randomize();
    }, $scope.interval);            
  };
    
  $scope.visual = function (){
    $scope.snd = Math.floor(Math.random() * _.size($scope.set));
    $scope.note = $scope.set[$scope.snd];
  };
       
  $scope.Visual = function (){ 
    $scope.Snd = Math.floor(Math.random() * _.size($scope.Set));
    $scope.Note = $scope.Set[$scope.Snd];
  };
        
  $scope.changetempo = function() {
    $scope.interval = 60000 / $scope._tempo * 0.25;
  };
  
  $scope.changemidi = function() {
    Jazz.MidiOutOpen($scope._out); Jazz.MidiOut(0xc0, _.indexOf($scope.sounds, $scope._sound), 0);
    select_out.blur();
  };
    
  $scope.updown = function() {
    var beat = Number($scope.Lpattern[$scope.count]);
    return beat;
  };
  
  $scope.Updown = function() {
    var beat = Number($scope.Rpattern[$scope.count]);
    return beat;
  };
  
  var tick = function (){
    $scope.count ++;
    if($scope.count >= $scope.beats) $scope.count = 0; 
    if ($scope.checked) $scope.metronome();
    Jazz.MidiOut(0x99,$scope.updown() ? $scope.note : 0, 111);
    Jazz.MidiOut(0x99, $scope.Updown() ? $scope.Note : 0, 111);
    timeout = $timeout(function() {
      tick();
    }, $scope.interval);
  }
  
  $scope.metronome = function (){
    Jazz.MidiOut(0x99, $scope.count ? 0 : 34, 127);
  };

  $scope.mas = {
    26 : "Silence", 27 : "High-Q", 28 : "Slap", 29 : "Scratch Push", 30 : "Scratch Pull", 31 : "Sticks", 32 : "Square Click", 33 : "Metronome Click",
    34 : "Metronome Bell", 35 : "Acoustic Bass Drum", 36 : "Bass Drum", 37 : "Side Stick", 38 : "Acoustic Snare", 39 : "Hand Clap", 40 : "Electric Snare",
    41 : "Low Floor Tom", 42 : "Closed Hi Hat", 43 : "High Floor Tom", 44 : "Pedal Hi-Hat", 45 : "Low Tom", 46 : "Open Hi-Hat", 47 : "Low-Mid Tom",
    48 : "Hi-Mid Tom", 49 : "Crash Cymbal 1", 50 : "High Tom", 51 : "Ride Cymbal 1", 52 : "Chinese Cymbal", 53 : "Ride Bell", 54 : "Tambourine", 55 : "Splash Cymbal",
    56 : "Cowbell", 57 : "Crash Cymbal 2", 58 : "Vibraslap", 59 : "Ride Cymbal 2", 60 : "Hi Bongo", 61 : "Low Bongo", 62 : "Mute Hi Conga", 63 : "Open Hi Conga",
    64 : "Low Conga", 65 : "High Timbale", 66 : "Low Timbale", 67 : "High Agogo", 68 : "Low Agogo", 69 : "Cabasa", 70 : "Maracas", 71 : "Short Whistle",
    72 : "Long Whistle", 73 : "Short Guiro", 74 : "Long Guiro", 75 : "Claves", 76 : "Hi Wood Block", 77 : "Low Wood Block", 78 : "Mute Cuica", 79 : "Open Cuica",
    80 : "Mute Triangle", 81 : "Open Triangle", 82 : "Shaker", 83 : "Jingle Bell", 84 : "Bell Tree", 85 : "Castanets", 86 : "Mute Surdo", 87 : "Open Surdo"
  }
 
  $scope.R1 = [{p: "10101010", bg: "tomato"}, {p: "10100110", bg: "#66FFFF"}, {p: "10011010", bg: "#66FFFF"}, {p: "10110110", bg: "#66CCFF"}, {p: "10010010", bg: "#FFCCFF"}, {p: "10010110", bg: "#CCFF99"}, {p: "10110010", bg: "#FFFF99"}];
  $scope.R2 = [{p: "10101100", bg: "#FFFF99"}, {p: "10100100", bg: "#FFCCFF"}, {p: "10110100", bg: "#CCFF99"}, {p: "10010100", bg: "#FFCCFF"}];
  $scope.R3 = [{p: "10100101", bg: "#CCFF99"}, {p: "10101101", bg: "#66CCFF"}, {p: "10110101", bg: "#66CCFF"}, {p: "10010101", bg: "#FFFF99"}, {p: "10101001", bg: "#66FFFF"}, {p: "10011001", bg: "#FFCC66"}];
  $scope.R4 = ["10011011", "10010011", "10101011", "10110011"];
  $scope.R5 = [{p: "11001100", bg: "#FFCC66"}, {p: "11010100", bg: "#66FFFF"}];
  $scope.R6 = [{p: "11001010", bg: "#FFFF99"}, {p: "11011010", bg: "#66CCFF"}, {p: "11010010", bg: "#CCFF99"}, {p: "11010110", bg: "#66CCFF"}];
  $scope.R7 = ["11011011", "11010011", "11001011"];
  $scope.R8 = ["11011001", "11001001", "11010101", "11001101"];
  $scope.L1 = [{p: "01010101", bg: "tomato"}, {p: "01011001", bg: "#FFFF99"}, {p: "01100101", bg: "#FFFF99"}, {p: "01001001", bg: "#FFCCFF"}, {p: "01101101", bg: "#66CCFF"}, {p: "01101001", bg: "#CCFF99"}, {p: "01001101", bg: "#66FFFF"}];
  $scope.L2 = [{p: "01010011", bg: "#66FFFF"}, {p: "01011011", bg: "#66CCFF"}, {p: "01001011", bg: "#CCFF99"}, {p: "01101011", bg: "#66CCFF"}];
  $scope.L3 = [{p: "01011010", bg: "#CCFF99"}, {p: "01010010", bg: "#FFCCFF"}, {p: "01001010", bg: "#FFCCFF"}, {p: "01101010", bg: "#66FFFF"}, {p: "01010110", bg: "#FFFF99"}, {p: "01100110", bg: "#FFCC66"}];
  $scope.L4 = ["01100100", "01101100", "01010100", "01001100"];
  $scope.L5 = [{p: "00110011", bg: "#FFCC66"}, {p: "00101011", bg: "#FFFF99"}]; 
  $scope.L6 = [{p: "00110101", bg: "#66FFFF"}, {p: "00100101", bg: "#FFCCFF"}, {p: "00101101", bg: "#CCFF99"}, {p: "00101001", bg: "#FFCCFF"}];
  $scope.L7 = ["00100100", "00101100", "00110100"];
  $scope.L8 = ["00100110", "00110110", "00101010", "00110010"]; 

  Jazz = document.getElementById("Jazz1"); if(!Jazz || !Jazz.isJazz) Jazz = document.getElementById("Jazz2");
  $scope.interval = 120;
  $scope.W = window.innerWidth * 0.34;
  $scope.state = true;
  $scope.playing = 'Play'; $scope.Playing = false;
  $scope.list = Jazz.MidiOutList();
  $scope._out = $scope.list[0];
  $scope.count = 1;
  $scope.beats = 8;
  $scope._tempo = 125;
  $scope.Lpattern = "01001011";
  $scope.Rpattern = "10110100";
  $scope.set = [];
  $scope.Set = [];
    
  $scope.changeRpattern = function(p) {
    $scope.Rpattern = p;
    console.log($scope.Rpattern);
  }
  $scope.changeLpattern = function(p) {
    $scope.Lpattern = p;
    console.log($scope.Lpattern);
  }
  
  $scope.blur = function() { $("input").blur(); }
};
  
</script>-->
</body>
</html>